# 日历应用 (CalendarApp)

一个功能丰富的macOS日历应用，支持查看日历、记录日记，并提供iCloud同步功能。

## 主要功能

### 📅 日历视图
- **美观的月历界面**：带有渐变背景和现代化设计
- **多记录支持**：每个日期可以添加多条记录
- **智能预览**：在日历格子中预览记录内容
- **单记录快速编辑**：✨ **新功能** 直接点击日历中的记录条目进行快速编辑
- **记录数量显示**：当一天有多条记录时显示数量标记
- **颜色编码**：不同记录用不同颜色区分

### 📝 记录管理
- **多条记录**：每个日期可以有无限条记录
- **多行支持**：每条记录支持多行文本内容
- **实时编辑**：支持添加、编辑、删除单独的记录
- **快速编辑**：✨ **新功能** 在日历视图中直接点击记录条目进行编辑
- **时间戳**：自动记录创建和修改时间
- **便捷操作**：快捷键支持 (Cmd+N添加记录, Cmd+Enter保存)

### ☁️ iCloud同步
- **自动同步**：支持iCloud数据同步
- **状态显示**：实时显示同步状态
- **离线支持**：未连接时支持本地存储
- **冲突处理**：智能合并云端和本地数据

### 🎨 界面特色
- **现代设计**：使用SwiftUI构建的现代化界面
- **响应式布局**：自适应不同窗口大小
- **农历显示**：显示中国农历信息
- **节日提醒**：显示传统节日和节气

## 使用方法

### 基本操作
1. **查看日历**：启动应用后即可看到当前月份的日历
2. **切换月份**：点击左右箭头切换月份
3. **添加记录**：点击日期即可打开记录管理界面
4. **编辑记录**：在记录列表中点击编辑按钮
5. **快速编辑记录**：✨ **新功能** 直接点击日历中显示的记录条目
6. **删除记录**：在记录列表中点击删除按钮

### 新增功能：单记录快速编辑
现在您可以直接在日历视图中操作记录：

#### 在日历视图中：
- **点击记录条目**：直接点击日历格子中显示的记录条目（彩色竖线旁的文字）
- **快速编辑**：弹出专门的快速编辑窗口，只编辑该条记录
- **实时更新**：编辑后立即在日历中看到更新结果
- **点击空白区域**：点击日期格子的空白区域仍然会打开完整的记录管理界面

#### 交互方式：
- **单记录编辑**：点击具体的记录条目 → 快速编辑弹窗
- **完整记录管理**：点击日期空白区域 → 完整的记录管理界面
- **键盘快捷键**：在快速编辑窗口中使用 Cmd+Enter 保存，Escape 取消

### 键盘快捷键
- `Cmd + N`：添加新记录
- `Cmd + Enter`：保存记录
- `Escape`：关闭弹窗
- `Cmd + E`：快速编辑

### 多记录功能
每个日期现在支持多条独立的记录：

#### 在日历视图中：
- 有记录的日期会显示蓝色小圆点
- 有多条记录时显示橙色数字标记
- 鼠标悬停可预览记录内容
- 不同记录用不同颜色的竖线区分
- ✨ **点击记录条目直接编辑**：点击显示的记录文字可直接编辑该条记录

#### 在编辑界面中：
- 显示该日期的所有记录列表
- 每条记录独立显示和编辑
- 支持快速添加新记录
- 显示创建和修改时间

### iCloud设置
1. 打开设置页面（点击齿轮图标）
2. 启用"iCloud同步"
3. 确保已登录iCloud账户
4. 数据将自动同步到所有设备

## 运行方式

### 本地模式（推荐）
```bash
./run_local.sh
```
在本地模式下运行，数据保存在本地，不使用iCloud功能。

### 签名模式（支持iCloud）
```bash
./sign_app.sh
```
构建签名应用，支持完整的iCloud同步功能（需要Apple开发者账号）。

## 技术架构

### 数据模型
- `RecordItem`：单条记录模型，包含内容、创建时间、修改时间
- `DayRecord`：日期记录模型，包含多个RecordItem
- `DayRecordManager`：记录管理器，处理所有CRUD操作

### 界面组件
- `CalendarView`：主日历视图
- `DayCell`：日期单元格，支持多记录预览
- `EditView`：记录管理界面
- `RecordItemView`：单条记录显示组件
- `RecordEditSheet`：记录编辑弹窗

### 存储方案
- **本地存储**：JSON文件存储在`tmp/dayRecords.json`
- **iCloud存储**：使用CloudKit私有数据库
- **数据同步**：支持本地和云端数据合并

## 项目结构

```
Sources/CalendarApp/
├── CalendarApp.swift          # 应用入口
├── Models/
│   ├── DayRecord.swift        # 数据模型
│   └── CalendarModel.swift    # 日历模型
├── Views/
│   ├── CalendarView.swift     # 主日历视图
│   ├── EditView.swift         # 记录编辑视图
│   └── SettingsView.swift     # 设置页面
└── Utils/
    ├── CloudKitManager.swift  # iCloud管理
    ├── ChineseCalendar.swift  # 农历计算
    └── DateExtensions.swift   # 日期扩展
```

## 更新历史

### v2.1.0 - 单记录快速编辑
- ✨ 新增在日历视图中直接点击记录条目进行编辑
- ✨ 单记录快速编辑弹窗，专注于编辑单条记录
- ✨ 改进的用户交互体验：区分记录点击和日期点击
- ✨ 实时编辑反馈，立即看到更改结果
- 🔧 优化了日历格子中的记录显示和点击区域

### v2.0.0 - 多记录支持
- ✨ 每个日期支持多条记录
- ✨ 记录列表界面重新设计
- ✨ 改进的日历预览显示
- ✨ 更好的记录管理体验
- ✨ 支持单条记录的编辑和删除

### v1.0.0 - 基础版本
- 📅 基本日历功能
- 📝 简单日记记录
- ☁️ iCloud同步支持
- 🎨 现代化界面设计

## 系统要求

- macOS 12.0 或更高版本
- Swift 5.9 或更高版本
- Xcode 15.0 或更高版本（用于签名模式）

## 许可证

MIT License

## 贡献

欢迎提交Issues和Pull Requests来改进这个项目。 